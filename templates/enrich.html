<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CpGenius — Enrichment Analysis</title>
  <link rel="stylesheet" href="/static/css/output.css">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <div class="w-full mx-auto p-6 max-w-7xl">
    <header class="mb-6 flex items-center justify-between">
      <div>
        <h1
          class="text-2xl sm:text-4xl font-semibold tracking-tight bg-gradient-to-r from-cyan-400 via-fuchsia-400 to-violet-400 bg-clip-text text-transparent drop-shadow-[0_0_12px_rgba(34,211,238,0.35)]">
          <img src="/static/images/logo.png" alt="App Favicon" class="inline-block w-8 h-8 align-middle mr-2" />
          <a href="/">Enrichment Analysis</a>
        </h1>
        <p class="text-slate-400 text-sm mt-1 text-left pl-10">Powered by: <a href="https://maayanlab.cloud/Enrichr"
            class="text-cyan-600 hover:text-cyan-700 font-bold">Enrichr</a></p>
      </div>
      <!-- Navigation Buttons -->
      <div class="flex items-center gap-3">
        <!-- Home Button -->
        <a href="/"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-xl border border-cyan-700 hover:border-cyan-500 bg-cyan-800/40 hover:bg-cyan-800/60 text-cyan-200 hover:text-cyan-100 transition-all duration-200 shadow-[0_0_15px_rgba(34,211,238,0.3)] hover:shadow-[0_0_25px_rgba(34,211,238,0.5)]">
          <svg viewBox="0 0 24 24" class="h-5 w-5 text-cyan-400" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9,22 9,12 15,12 15,22" />
          </svg>

        </a>

      </div>
    </header>

    <!-- Card -->
    <div
      class="rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur shadow-[0_0_40px_rgba(168,85,247,0.15)]">
      <form id="enrichForm" class="p-6 space-y-6" onsubmit="return false;">
        <!-- File input -->
        <div>
          <label class="block text-sm font-medium text-slate-300 mb-2">Upload CSV (must include a <code>Feature</code>
            column)</label>
          <input id="csvFile" type="file" accept=".csv"
            class="w-full sm:w-auto inline-flex items-center justify-center gap-2 rounded-2xl border-0 bg-slate-800 file:mr-4 file:py-3 file:px-5 file:rounded-2xl file:border-0 file:text-base file:font-medium file:bg-slate-800 file:text-slate-100 hover:file:bg-slate-700 cursor-pointer text-slate-200 px-6 py-3 text-base sm:text-lg" />
          <p class="text-sm text-slate-400 mt-2"> The input should be provided as a <code> .csv </code> file containing the genes that have been mapped to the CpG sites selected through the exeriment. Each row. A column named "GeneName" containing all relevant gene symbols must be included in the file. For reference, you can download a toy example dataset (enrichment_example) from the following <a href="https://drive.google.com/file/d/1E2wNI5dd0L5ymQ1UfCCg5o7uW2hnj_Ee/view?usp=sharing" target="_blank" class="text-cyan-600">link</a>. Once downloaded select the .csv file from the "Choose File" button
          </p>
        </div>

        <!-- Options -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Gene column</label>
            <input id="geneCol" type="text" value="GeneName"
              class="w-full rounded-2xl border-slate-800 bg-slate-800/70 text-cyan-300 font-mono text-sm sm:text-base px-3 py-2" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Library (pathways)</label>
            <select id="library"
              class="w-full rounded-2xl border-slate-800 bg-slate-800/70 text-fuchsia-300 font-mono text-sm sm:text-base px-3 py-2">
              <option value="Reactome_2022">Reactome_2022</option>
              <option value="KEGG_2021_Human">KEGG_2021_Human</option>
              <option value="WikiPathways_2023_Human">WikiPathways_2023_Human</option>
              <option value="BioPlanet_2019">BioPlanet_2019</option>
            </select>
          </div>
          <div id="geneCountContainer" class="hidden">
            <label class="block text-sm font-medium text-slate-300 mb-2">Number of genes to use: <span
                id="geneCountDisplay" class="text-emerald-400 font-bold">5</span> of <span id="totalGenesDisplay"
                class="text-slate-400">0</span></label>
            <input id="geneCountSlider" type="range" min="5" max="5" value="5" step="1"
              class="w-full h-3 bg-gradient-to-r from-emerald-600 to-cyan-600 rounded-lg appearance-none cursor-pointer slider"
              style="background: linear-gradient(90deg, rgb(5 150 105), rgb(8 145 178)); outline: none; box-shadow: 0 0 15px rgba(5,150,105,0.3);" />
          </div>
          <div class="sm:col-span-2 hidden">
            <label class="block text-sm font-medium text-slate-300 mb-2">Description (optional)</label>
            <input id="desc" type="text" placeholder="gene-list"
              class="w-full rounded-2xl border-slate-800 bg-slate-800/70 text-violet-300 font-mono text-sm sm:text-base px-3 py-2" />
          </div>
        </div>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
          <button id="runBtn" type="button" aria-live="polite"
            class="w-full sm:w-auto inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-cyan-500 to-fuchsia-500 px-6 py-3 text-base sm:text-lg font-semibold shadow-lg shadow-cyan-500/20 ring-1 ring-cyan-400/30 hover:from-cyan-400 hover:to-fuchsia-400 hover:ring-cyan-300/50 active:scale-[.99] disabled:opacity-50 disabled:cursor-not-allowed">
            <svg id="spinner" class="hidden animate-spin h-5 w-5" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <span>Run enrichment</span>
          </button>
          <button id="loadLibsBtn" type="button"
            class="w-full sm:w-auto px-6 py-3 text-base sm:text-lg rounded-2xl border border-slate-700 hover:border-slate-500 bg-slate-800/40 hover:bg-slate-800/60">
            Fetch pathway libraries
          </button>
          <button id="downloadCsv" type="button"
            class="w-full sm:w-auto px-6 py-3 text-base sm:text-lg rounded-2xl border border-slate-700 hover:border-slate-500 bg-slate-800/40 hover:bg-slate-800/60">
            Download CSV
          </button>
        </div>

        <div id="status" class="hidden rounded-2xl border px-4 py-3 text-sm sm:text-base font-medium"></div>
      </form>
    </div>

    <!-- Results -->
    <div id="results" class="hidden mt-6 space-y-6">
      <!-- Bars -->
      <div
        class="rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur shadow-[0_0_40px_rgba(34,211,238,0.15)] p-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-medium">Top terms — bars sorted by Combined Score (desc)</h3>
          <label class="text-sm text-slate-300 flex items-center gap-2"><input id="sortSelect" type="checkbox"
              class="rounded" checked /> Sort table by p-value</label>
        </div>
        <div id="bars" class="space-y-3"></div>
      </div>

      <!-- Table -->
      <div
        class="overflow-x-auto rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur shadow-[0_0_40px_rgba(139,92,246,0.15)]">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="text-left bg-slate-900/70">
              <th class="px-3 py-2">#</th>
              <th class="px-3 py-2">Pathway</th>
              <th class="px-3 py-2">Pathway Genes</th>
              <th class="px-3 py-2">Overlap</th>
              <th class="px-3 py-2">p-value</th>
              <th class="px-3 py-2">Combined Score</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-slate-800"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="/static/js/enrich.js"></script>
</body>

</html>