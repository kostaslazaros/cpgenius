<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CpGene — Documentation</title>
  <link rel="stylesheet" href="/static/css/output.css">
  <!-- Markdown styling (GitHub-like, dark) - local vendor wrapper -->
  <link rel="stylesheet" href="/static/vendor/markdown-dark.css">
  <!-- Highlight.js theme - local vendor wrapper -->
  <link rel="stylesheet" href="/static/vendor/hljs-dark.css">
  <!-- Mermaid SVG visibility fixes for dark theme -->
  <style>
    /* Ensure mermaid SVG paths and shapes are visible on dark backgrounds */
    .mermaid svg {
      width: 100% !important;
      height: auto !important;
    }

    /* Neon styling for lines */
    .mermaid svg path,
    .mermaid svg polyline,
    .mermaid svg polygon,
    .mermaid svg line,
    .mermaid svg circle,
    .mermaid svg rect {
      stroke: #7ef0ff !important;
      /* neon cyan */
      stroke-width: 1.6 !important;
      fill: none !important;
      opacity: 0.98 !important;
      filter: drop-shadow(0 0 6px rgba(126, 240, 255, 0.35)) drop-shadow(0 0 10px rgba(189, 79, 255, 0.08));
    }

    /* Node backgrounds and stroke mix to give a subtle neon card look */
    .mermaid svg .node rect,
    .mermaid svg .node ellipse,
    .mermaid svg .node circle {
      fill: linear-gradient(#0f172a, #0b1220) !important;
      fill: rgba(10, 12, 16, 0.18) !important;
      stroke: #7ef0ff !important;
      stroke-width: 1.4 !important;
      filter: drop-shadow(0 0 6px rgba(126, 240, 255, 0.18));
    }

    /* Force fuchsia text for all Mermaid textual elements using high-specificity selectors */
    .mermaid svg text,
    .mermaid svg tspan,
    .mermaid svg .label,
    .mermaid svg .edgeLabel text,
    .mermaid svg .node text,
    .mermaid svg foreignObject * {
      color: #ff4fcf !important;
      fill: #ff4fcf !important;
      /* svg text */
      stroke: #6b0036 !important;
      /* subtle dark stroke for contrast */
      font-weight: 800 !important;
      text-shadow: 0 0 10px rgba(255, 79, 207, 0.45), 0 0 18px rgba(189, 79, 255, 0.12) !important;
    }

    /* Ensure edge labels also get the same fuchsia */
    .mermaid svg .edgeLabel text {
      fill: #ff4fcf !important;
    }

    /* Hover emphasis (enhance glow on hover) */
    .mermaid svg :is(path, polyline, line):hover {
      filter: drop-shadow(0 0 14px rgba(126, 240, 255, 0.55));
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <div class="w-full max-w-7xl mx-auto p-6">
    <header class="mb-6 flex items-center justify-between">
      <h1
        class="text-2xl sm:text-4xl font-semibold tracking-tight bg-gradient-to-r from-cyan-400 via-fuchsia-400 to-violet-400 bg-clip-text text-transparent drop-shadow-[0_0_12px_rgba(34,211,238,0.35)]">
        <img src="/static/images/logo.png" alt="CpGene Favicon" class="inline-block w-8 h-8 align-middle mr-2" />
        {{ title | default('Documentation') }}
      </h1>
      <div class="flex items-center gap-3">
        <a href="/"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-xl border border-cyan-700 hover:border-cyan-500 bg-cyan-800/40 hover:bg-cyan-800/60 text-cyan-200 hover:text-cyan-100 transition-all duration-200 shadow-[0_0_15px_rgba(34,211,238,0.3)] hover:shadow-[0_0_25px_rgba(34,211,238,0.5)]">
          <svg viewBox="0 0 24 24" class="h-5 w-5 text-cyan-400" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9,22 9,12 15,12 15,22" />
          </svg>

        </a>
      </div>
    </header>

    <div
      class="rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur shadow-[0_0_40px_rgba(168,85,247,0.15)] p-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Sidebar / TOC -->
        <aside class="md:col-span-1">
          <div class="sticky top-6">
            <h2 class="text-lg font-semibold text-slate-200 mb-3">Contents</h2>
            <nav class="space-y-2 text-sm text-slate-300">
              {# If the router provided a `pages` list (scanned from /docs), render it as the primary index #}
              {% if pages %}
              <ul class="space-y-1">
                {% for p in pages %}
                <li>
                  <a href="/documentation/{{ p.slug }}"
                    class="block px-2 py-1 rounded-lg transition-colors duration-150 {% if current_page == p.slug %}bg-slate-800 text-cyan-300 font-semibold{% else %}hover:bg-slate-800/40 hover:text-cyan-300{% endif %}">
                    {{ p.title }}
                  </a>
                </li>
                {% endfor %}
              </ul>

              {# If a per-page TOC was generated, show it below the page list for quick navigation within the page #}
              {% if toc %}
              <div class="mt-4 text-xs text-slate-400">
                <h3 class="text-sm font-medium text-slate-200 mb-2">This page</h3>
                <div class="markdown-body text-xs">
                  {{ toc | safe }}
                </div>
              </div>
              {% endif %}

              {% else %}
              {# Fallback: show the raw TOC if pages unavailable, else a static list #}
              {% if toc %}
              <div class="markdown-body">
                {{ toc | safe }}
              </div>
              {% else %}
              <a href="/documentation/overview" class="block hover:text-cyan-300">Overview</a>
              <a href="/documentation/getting-started" class="block hover:text-cyan-300">Getting Started</a>
              <a href="/documentation/api" class="block hover:text-cyan-300">API</a>
              <a href="/documentation/architecture" class="block hover:text-cyan-300">Architecture</a>
              <a href="/documentation/faq" class="block hover:text-cyan-300">FAQ</a>
              {% endif %}
              {% endif %}
            </nav>
          </div>
        </aside>

        <!-- Main content -->
        <main class="md:col-span-3 space-y-8">
          <section id="overview">

            <!-- Main content: server-rendered HTML from markdown will be injected here -->
            <div class="md:col-span-3 space-y-8">
              {% if content %}
              <!-- markdown-body provides GitHub-like styling; we add some padding and rounded backdrop -->
              <article class="markdown-body bg-slate-900/60 p-6 rounded-lg shadow-sm overflow-auto">
                {{ content | safe }}
              </article>
              {% else %}
              <section>
                <h3 class="text-xl font-semibold text-slate-100 mb-2">No documentation available</h3>
                <p class="text-slate-300">No documentation content was provided for this page.</p>
              </section>
              {% endif %}
            </div>
          </section>
        </main>

</body>

</html>

<!-- Highlight.js loader (local wrapper) -->
<!-- Mermaid loader (local wrapper) -->
<script src="/static/vendor/mermaid-loader.js"></script>
<!-- Highlight.js loader (local wrapper) -->
<script src="/static/vendor/hljs-loader.js"></script>
<script>
  // Initialize highlight.js when available, plus copy buttons and smooth scrolling
  document.addEventListener('DOMContentLoaded', () => {
    // Convert fenced ```mermaid code blocks into <div class="mermaid">...</div>.
    // Markdown renderers sometimes wrap code blocks in containers like div.codehilite > pre > code
    // or div.highlight > pre > code. We'll check a few common patterns.
    (function convertMermaid() {
      // Helper to replace a block element with mermaid div
      function replaceWithMermaid(container, text) {
        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = text;
        if (container && container.parentElement) container.parentElement.replaceChild(mermaidDiv, container);
      }

      // 1) <pre><code class="language-mermaid">...
      document.querySelectorAll('pre code').forEach((el) => {
        try {
          const cls = el.className || '';
          if (/language-?mermaid/.test(cls)) {
            const pre = el.closest('pre') || el.parentElement;
            replaceWithMermaid(pre, el.textContent || '');
          }
        } catch (e) {
          /* ignore */
        }
      });

      // 2) codehilite/highlight wrappers e.g. div.codehilite > pre > code or div.highlight > pre > code
      document.querySelectorAll('div.codehilite, div.highlight').forEach((wrapper) => {
        try {
          const code = wrapper.querySelector('pre code, pre');
          if (!code) return;
          const text = (code.textContent || '').trim();
          // If the first line looks like a mermaid directive or contains mermaid graph keywords, treat as mermaid
          if (/^%%?mermaid|graph\s|flowchart|sequenceDiagram|classDiagram|stateDiagram|gantt/i.test(text)) {
            replaceWithMermaid(wrapper, text);
          }
        } catch (e) {
          /* ignore */
        }
      });
    })();

    // Add copy buttons to code blocks regardless of highlight.js availability
    function addCopyButtons() {
      document.querySelectorAll('pre').forEach((pre) => {
        try {
          // Don't add if a copy button already exists
          if (pre.querySelector('.copy-btn')) return;
          const code = pre.querySelector('code') || pre;
          const btn = document.createElement('button');
          btn.className = 'copy-btn ml-2 px-2 py-1 text-xs rounded bg-slate-800/40 hover:bg-slate-700/50 text-slate-200';
          btn.type = 'button';
          btn.setAttribute('aria-label', 'Copy code');
          btn.innerText = 'Copy';
          btn.style.cursor = 'pointer';

          btn.addEventListener('click', async (ev) => {
            ev.stopPropagation();
            const text = (code && code.innerText) ? code.innerText : pre.innerText || '';
            const trimmed = text.trim();
            // Try modern clipboard API first
            try {
              if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(trimmed);
              } else {
                throw new Error('navigator.clipboard unavailable');
              }
              const prev = btn.innerText;
              btn.innerText = 'Copied';
              setTimeout(() => (btn.innerText = prev), 1500);
              return;
            } catch (err) {
              // Fallback for older browsers: use a temporary textarea and execCommand
              try {
                const ta = document.createElement('textarea');
                ta.value = trimmed;
                // Avoid scrolling to bottom
                ta.style.position = 'fixed';
                ta.style.top = '-9999px';
                document.body.appendChild(ta);
                ta.focus();
                ta.select();
                const ok = document.execCommand('copy');
                document.body.removeChild(ta);
                if (ok) {
                  const prev = btn.innerText;
                  btn.innerText = 'Copied';
                  setTimeout(() => (btn.innerText = prev), 1500);
                  return;
                }
                throw new Error('execCommand copy failed');
              } catch (err2) {
                console.error('Copy failed (both clipboard API and execCommand):', err, err2);
                btn.innerText = 'Error';
                setTimeout(() => (btn.innerText = 'Copy'), 1500);
                return;
              }
            }
          });

          // Positioning: ensure pre is positioned so absolute button aligns
          if (getComputedStyle(pre).position === 'static') pre.style.position = 'relative';
          btn.style.position = 'absolute';
          btn.style.top = '8px';
          btn.style.right = '8px';
          pre.appendChild(btn);
        } catch (e) {
          /* ignore */
        }
      });
    }

    // Call immediately after conversion so buttons are present even if hljs isn't loaded
    addCopyButtons();

    const whenHljsReady = new Promise((resolve) => {
      let attempts = 0
      const t = setInterval(() => {
        if (window.hljs) {
          clearInterval(t)
          resolve(window.hljs)
        }
        attempts++
        if (attempts > 50) {
          clearInterval(t)
          resolve(null)
        }
      }, 100)
    })

    whenHljsReady.then((hljs) => {
      if (hljs) {
        document.querySelectorAll('pre code').forEach((el) => {
          try {
            // By this point mermaid blocks have been converted, so highlight only real code blocks
            hljs.highlightElement(el)
          } catch (e) {
            /* ignore */
          }

          // copy buttons are managed by addCopyButtons()
        })
      }

      // Smooth scrolling for sidebar TOC links — handle both local TOC anchors and sidebar links
      document.querySelectorAll('a[href^="#"]').forEach((a) => {
        a.addEventListener('click', (e) => {
          e.preventDefault()
          const id = a.getAttribute('href').slice(1)
          const target = document.getElementById(id)
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' })
        })
      })
    })

    // Initialize Mermaid when available (render any .mermaid containers)
    const whenMermaidReady = new Promise((resolve) => {
      let attempts = 0
      const t = setInterval(() => {
        if (window.mermaid) {
          clearInterval(t)
          resolve(window.mermaid)
        }
        attempts++
        if (attempts > 50) {
          clearInterval(t)
          resolve(null)
        }
      }, 100)
    })

    whenMermaidReady.then((mermaid) => {
      if (mermaid) {
        try {
          // Render any mermaid blocks we created earlier
          mermaid.init(undefined, document.querySelectorAll('.mermaid'))
        } catch (e) {
          console.warn('Mermaid rendering failed', e)
        }
      }
    })
  })
</script>